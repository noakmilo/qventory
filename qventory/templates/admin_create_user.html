{% extends "base_admin.html" %}
{% block title %}Create User â€“ Admin{% endblock %}

{% block breadcrumb_items %}
<span class="breadcrumb-separator">/</span>
<span class="breadcrumb-current">Create User</span>
{% endblock %}

{% block content %}
<div class="row">
  <div class="card" style="max-width:600px;margin:0 auto;width:98%;">
    <h1>Create New User</h1>
    <p style="color:var(--sub);margin-bottom:var(--space-4);">Add a new user account to the system</p>

    <form method="post" class="grid cols-1">
      <div>
        <label class="label" for="username">Username</label>
        <input type="text" class="input" id="username" name="username" required autofocus>
        <small class="form-hint">Lowercase, no spaces</small>
      </div>

      <div>
        <label class="label" for="email">Email</label>
        <input type="email" class="input" id="email" name="email" required>
      </div>

      <div>
        <label class="label" for="password">Password</label>
        <div style="display:flex;gap:var(--space-2);">
          <input type="password" class="input" id="password" name="password" required style="flex:1;">
          <button type="button" class="btn" id="generatePassword" style="white-space:nowrap;">Generate</button>
          <button type="button" class="btn" id="togglePassword" style="white-space:nowrap;">Show</button>
        </div>
        <small class="form-hint">Minimum 6 characters recommended</small>
      </div>

      <div class="form-actions">
        <button type="submit" class="btn submitbtn">Create User</button>
        <a href="{{ url_for('main.admin_dashboard') }}" class="btn">Cancel</a>
      </div>
    </form>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const passwordInput = document.getElementById('password');
  const generateBtn = document.getElementById('generatePassword');
  const toggleBtn = document.getElementById('togglePassword');

  // Generate strong 8-character password
  generateBtn.addEventListener('click', function() {
    const chars = 'ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz23456789!@#$%&*';
    let password = '';

    // Ensure at least: 1 uppercase, 1 lowercase, 1 number, 1 special char
    const upper = 'ABCDEFGHJKLMNPQRSTUVWXYZ';
    const lower = 'abcdefghijkmnopqrstuvwxyz';
    const numbers = '23456789';
    const special = '!@#$%&*';

    password += upper[Math.floor(Math.random() * upper.length)];
    password += lower[Math.floor(Math.random() * lower.length)];
    password += numbers[Math.floor(Math.random() * numbers.length)];
    password += special[Math.floor(Math.random() * special.length)];

    // Fill remaining 4 characters randomly
    for (let i = 4; i < 8; i++) {
      password += chars[Math.floor(Math.random() * chars.length)];
    }

    // Shuffle the password
    password = password.split('').sort(() => Math.random() - 0.5).join('');

    passwordInput.value = password;
    passwordInput.type = 'text';
    toggleBtn.textContent = 'Hide';

    // Copy to clipboard
    navigator.clipboard.writeText(password).then(() => {
      const originalText = generateBtn.textContent;
      generateBtn.textContent = 'Copied!';
      setTimeout(() => {
        generateBtn.textContent = originalText;
      }, 2000);
    });
  });

  // Toggle password visibility
  toggleBtn.addEventListener('click', function() {
    if (passwordInput.type === 'password') {
      passwordInput.type = 'text';
      toggleBtn.textContent = 'Hide';
    } else {
      passwordInput.type = 'password';
      toggleBtn.textContent = 'Show';
    }
  });
});
</script>
{% endblock %}
