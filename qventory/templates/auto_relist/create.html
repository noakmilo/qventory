{% extends "base_new.html" %}

{% block title %}Create Auto-Relist Rule - Qventory{% endblock %}

{% block breadcrumb_items %}
<span class="breadcrumb-separator">/</span>
<a href="{{ url_for('auto_relist.dashboard') }}" class="breadcrumb-link">Auto Relist</a>
<span class="breadcrumb-separator">/</span>
<span class="breadcrumb-current">Create Rule</span>
{% endblock %}

{% block content %}
<div class="container page-shell">

  <div style="margin-bottom:24px;">
    <h1 style="color:var(--text);font-size:28px;margin-bottom:8px;">
      <i class="fas fa-plus-circle"></i> Create Auto-Relist Rule
    </h1>
    <p style="color:var(--text-secondary);font-size:14px;">
      Set up automatic or manual relisting for your eBay offers
    </p>
  </div>

  <form method="POST" action="{{ url_for('auto_relist.create_rule') }}">
    <!-- Mode Selection -->
    <div class="card" style="margin-bottom:24px;">
      <div style="padding:20px;border-bottom:1px solid var(--border);">
        <h2 style="color:var(--text);font-size:18px;">1. Choose Mode</h2>
      </div>
      <div style="padding:24px;">
        <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:16px;">

          <!-- AUTO Mode -->
          <label class="mode-card" for="mode_auto">
            <input type="radio" name="mode" value="auto" id="mode_auto" checked required>
            <div class="mode-card-content">
              <i class="fas fa-robot" style="font-size:32px;color:#60a5fa;margin-bottom:12px;"></i>
              <h3 style="font-size:16px;margin-bottom:4px;">Automatic</h3>
              <p style="color:var(--text-secondary);font-size:12px;">
                Scheduled relist every N days
              </p>
            </div>
          </label>

          <!-- MANUAL Mode -->
          <label class="mode-card" for="mode_manual">
            <input type="radio" name="mode" value="manual" id="mode_manual" required>
            <div class="mode-card-content">
              <i class="fas fa-hand-pointer" style="font-size:32px;color:#fbbf24;margin-bottom:12px;"></i>
              <h3 style="font-size:16px;margin-bottom:4px;">Manual</h3>
              <p style="color:var(--text-secondary);font-size:12px;">
                One-time relist with optional changes
              </p>
            </div>
          </label>

        </div>
      </div>
    </div>

    <!-- Select Listing -->
    <div class="card" style="margin-bottom:24px;overflow:visible;position:relative;z-index:200;">
      <div style="padding:20px;border-bottom:1px solid var(--border);">
        <h2 style="color:var(--text);font-size:18px;">2. Select Listing</h2>
      </div>
      <div style="padding:24px;position:relative;overflow:visible;">
        <!-- Autocomplete Search -->
        <div class="form-group">
          <label for="item_search">Search for listing by title, SKU, or listing ID *</label>
          <div class="autocomplete-wrapper" style="position:relative;">
            <input
              type="text"
              id="item_search"
              class="form-control"
              placeholder="Type at least 2 characters to search..."
              autocomplete="off"
              style="padding-right:40px;"
            >
            <div id="search_spinner" style="display:none;position:absolute;right:12px;top:50%;transform:translateY(-50%);z-index:10;">
              <i class="fas fa-spinner fa-spin" style="color:var(--text-tertiary);"></i>
            </div>

            <!-- Dropdown Results -->
            <div id="search_results" class="autocomplete-dropdown" style="display:none;">
              <!-- Results populated by JS -->
            </div>
          </div>

          <small style="color:var(--text-tertiary);font-size:11px;margin-top:4px;display:block;">
            Start typing to search your active eBay listings
          </small>
        </div>

        <!-- Hidden fields populated by autocomplete -->
        <input type="hidden" name="offer_id" id="hidden_offer_id" required>
        <input type="hidden" name="sku" id="hidden_sku">
        <input type="hidden" name="item_title" id="hidden_title">
        <input type="hidden" name="current_price" id="hidden_price">
        <input type="hidden" name="listing_id" id="hidden_listing_id">
        <input type="hidden" name="marketplace_id" value="EBAY_US">

        <!-- Selected Item Preview -->
        <div id="selected_item_preview" style="display:none;margin-top:16px;padding:16px;background:var(--bg-secondary);border-radius:8px;border:1px solid var(--border);">
          <div style="display:flex;align-items:center;gap:12px;">
            <i class="fas fa-check-circle" style="color:#10b981;font-size:20px;"></i>
            <div style="flex:1;">
              <div style="font-size:12px;color:var(--text-secondary);margin-bottom:4px;">Selected Item:</div>
              <div style="font-weight:500;color:var(--text);" id="preview_title"></div>
              <div style="font-size:12px;color:var(--text-secondary);margin-top:4px;">
                <span id="preview_sku"></span>
                <span style="margin:0 8px;">|</span>
                Price: <span id="preview_price" style="font-weight:500;"></span>
                <span style="margin:0 8px;">|</span>
                Listing ID: <span id="preview_listing"></span>
              </div>
            </div>
            <button type="button" id="clear_selection" style="padding:6px 12px;border:1px solid var(--border);background:var(--bg);color:var(--text);border-radius:4px;cursor:pointer;font-size:12px;">
              <i class="fas fa-times"></i> Change
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- AUTO Mode Settings -->
    <div class="card auto-settings" style="margin-bottom:24px;display:none;position:relative;z-index:1;">
      <div style="padding:20px;border-bottom:1px solid var(--border);">
        <h2 style="color:var(--text);font-size:18px;">3. Configure Schedule</h2>
      </div>
      <div style="padding:24px;">

        <!-- Frequency -->
        <div class="form-group">
          <label for="frequency">Relist Frequency *</label>
          <select name="frequency" id="frequency" class="form-control">
            <option value="daily">Every Day</option>
            <option value="every_3_days">Every 3 Days</option>
            <option value="weekly" selected>Every Week (7 days)</option>
            <option value="every_10_days">Every 10 Days</option>
            <option value="biweekly">Every 2 Weeks (14 days)</option>
            <option value="every_20_days">Every 20 Days</option>
            <option value="monthly">Every Month (30 days)</option>
            <option value="custom">Custom Interval</option>
          </select>
        </div>

        <!-- Custom Interval -->
        <div class="form-group" id="custom_interval_group" style="display:none;">
          <label for="custom_interval_days">Custom Interval (days) *</label>
          <input type="number" name="custom_interval_days" id="custom_interval_days" class="form-control" min="1" max="365" value="7">
        </div>

        <!-- First Run -->
        <div style="margin-top:24px;padding-top:24px;border-top:1px solid var(--border);">
          <h3 style="font-size:14px;margin-bottom:16px;color:var(--text);">
            <i class="fas fa-rocket"></i> First Relist
          </h3>
          <label class="checkbox-label">
            <input type="checkbox" name="run_first_relist_immediately" id="run_first_relist_immediately">
            <span>Run first relist immediately after creating rule</span>
          </label>
          <p style="font-size:11px;color:var(--text-tertiary);margin-top:8px;margin-left:24px;">
            If unchecked, first relist will run after the configured interval (e.g., 7 days)
          </p>
        </div>

        <!-- Quiet Hours (Collapsed by default) -->
        <div style="margin-top:24px;padding-top:24px;border-top:1px solid var(--border);">
          <div style="cursor:pointer;display:flex;justify-content:space-between;align-items:center;" onclick="document.getElementById('quiet_hours_content').style.display = document.getElementById('quiet_hours_content').style.display === 'none' ? 'block' : 'none'; this.querySelector('.toggle-icon').classList.toggle('rotated');">
            <h3 style="font-size:14px;margin-bottom:0;color:var(--text);">
              <i class="fas fa-moon"></i> Quiet Hours (Optional)
            </h3>
            <i class="fas fa-chevron-down toggle-icon" style="transition:transform 0.2s;font-size:12px;color:var(--text-tertiary);"></i>
          </div>
          <div id="quiet_hours_content" style="display:none;margin-top:16px;">
            <p style="font-size:12px;color:var(--text-secondary);margin-bottom:16px;">
              Relists will only run during this time window
            </p>

          <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;">
            <div class="form-group">
              <label for="quiet_hours_start">Start Time</label>
              <input type="time" name="quiet_hours_start" id="quiet_hours_start" class="form-control" value="02:00">
            </div>
            <div class="form-group">
              <label for="quiet_hours_end">End Time</label>
              <input type="time" name="quiet_hours_end" id="quiet_hours_end" class="form-control" value="05:00">
            </div>
          </div>

          <div class="form-group">
            <label for="timezone">Timezone</label>
            <select name="timezone" id="timezone" class="form-control">
              <option value="America/Los_Angeles" selected>Pacific (Los Angeles)</option>
              <option value="America/Denver">Mountain (Denver)</option>
              <option value="America/Chicago">Central (Chicago)</option>
              <option value="America/New_York">Eastern (New York)</option>
            </select>
          </div>
          </div>
        </div>

        <!-- Safety Rules (Collapsed by default) -->
        <div style="margin-top:24px;padding-top:24px;border-top:1px solid var(--border);">
          <div style="cursor:pointer;display:flex;justify-content:space-between;align-items:center;" onclick="document.getElementById('safety_rules_content').style.display = document.getElementById('safety_rules_content').style.display === 'none' ? 'block' : 'none'; this.querySelector('.toggle-icon').classList.toggle('rotated');">
            <h3 style="font-size:14px;margin-bottom:0;color:var(--text);">
              <i class="fas fa-shield-alt"></i> Safety Rules (Optional)
            </h3>
            <i class="fas fa-chevron-down toggle-icon" style="transition:transform 0.2s;font-size:12px;color:var(--text-tertiary);"></i>
          </div>
          <div id="safety_rules_content" style="display:none;margin-top:16px;">

          <div style="display:grid;gap:12px;">
            <label class="checkbox-label">
              <input type="checkbox" name="require_positive_quantity" checked>
              <span>Skip if quantity is zero</span>
            </label>

            <label class="checkbox-label">
              <input type="checkbox" name="check_active_returns" checked>
              <span>Skip if there are active returns</span>
            </label>

            <label class="checkbox-label">
              <input type="checkbox" name="pause_on_error" checked>
              <span>Pause rule after 3 consecutive errors</span>
            </label>
          </div>

          <div class="form-group" style="margin-top:16px;">
            <label for="min_hours_since_last_order">Skip if orders in last (hours)</label>
            <input type="number" name="min_hours_since_last_order" id="min_hours_since_last_order" class="form-control" value="48" min="0">
            <small style="color:var(--text-tertiary);font-size:11px;">
              Set to 0 to disable this check
            </small>
          </div>

          <div class="form-group">
            <label for="max_consecutive_errors">Max consecutive errors before pause</label>
            <input type="number" name="max_consecutive_errors" id="max_consecutive_errors" class="form-control" value="3" min="1" max="10">
          </div>
        </div>

        <!-- Price Decrease Strategy -->
        <div style="margin-top:24px;padding-top:24px;border-top:1px solid var(--border);">
          <h3 style="font-size:14px;margin-bottom:16px;color:var(--text);">
            <i class="fas fa-chart-line-down"></i> Price Decrease Strategy
          </h3>
          <p style="font-size:12px;color:var(--text-secondary);margin-bottom:16px;">
            Automatically decrease price with each relist until item sells or reaches minimum price
          </p>

          <label class="checkbox-label" style="margin-bottom:16px;">
            <input type="checkbox" name="enable_price_decrease" id="enable_price_decrease">
            <span>Enable automatic price decrease</span>
          </label>

          <div id="price_decrease_settings" style="display:none;padding-left:24px;border-left:3px solid var(--border);">
            <div class="form-group">
              <label for="price_decrease_type">Decrease Type *</label>
              <select name="price_decrease_type" id="price_decrease_type" class="form-control">
                <option value="fixed" selected>Fixed Amount ($)</option>
                <option value="percentage">Percentage (%)</option>
              </select>
            </div>

            <div class="form-group">
              <label for="price_decrease_amount">
                <span id="decrease_label">Decrease Amount ($) *</span>
              </label>
              <input type="number" name="price_decrease_amount" id="price_decrease_amount" class="form-control" min="0.01" step="0.01" placeholder="2.00">
              <small style="color:var(--text-tertiary);font-size:11px;" id="decrease_hint">
                Example: $29.99 → $27.99 → $25.99
              </small>
            </div>

            <div class="form-group">
              <label for="min_price">Minimum Price (floor) *</label>
              <input type="number" name="min_price" id="min_price" class="form-control" min="0.01" step="0.01" placeholder="15.00">
              <small style="color:var(--text-tertiary);font-size:11px;">
                Price will never go below this amount
              </small>
            </div>
          </div>
        </div>
          </div>
        </div>

      </div>
    </div>

    <!-- Additional Options (Collapsed by default) -->
    <div class="card auto-settings" style="margin-bottom:24px;position:relative;z-index:1;display:none;">
      <div style="padding:20px;border-bottom:1px solid var(--border);">
        <div style="cursor:pointer;display:flex;justify-content:space-between;align-items:center;" onclick="document.getElementById('additional_options_content').style.display = document.getElementById('additional_options_content').style.display === 'none' ? 'block' : 'none'; this.querySelector('.toggle-icon').classList.toggle('rotated');">
          <h2 style="color:var(--text);font-size:18px;margin:0;">
            <i class="fas fa-cog"></i> Additional Options (Optional)
          </h2>
          <i class="fas fa-chevron-down toggle-icon" style="transition:transform 0.2s;font-size:12px;color:var(--text-tertiary);"></i>
        </div>
      </div>
      <div id="additional_options_content" style="display:none;">
      <div style="padding:24px;">

        <div class="form-group">
          <label for="withdraw_publish_delay_seconds">Delay between withdraw and publish (seconds)</label>
          <input type="number" name="withdraw_publish_delay_seconds" id="withdraw_publish_delay_seconds" class="form-control" value="30" min="5" max="120">
          <small style="color:var(--text-tertiary);font-size:11px;">
            Recommended: 30 seconds to avoid eBay API issues
          </small>
        </div>

        <div class="form-group">
          <label for="notes">Notes (optional)</label>
          <textarea name="notes" id="notes" class="form-control" rows="3" placeholder="Add any notes about this rule..."></textarea>
        </div>

      </div>
    </div>

    <!-- Submit -->
    <div style="display:flex;justify-content:space-between;gap:12px;">
      <a href="{{ url_for('auto_relist.dashboard') }}" class="btn btn-secondary">
        <i class="fas fa-arrow-left"></i> Cancel
      </a>
      <button type="submit" class="btn btn-primary">
        <i class="fas fa-check"></i> Create Rule
      </button>
    </div>

  </form>

</div>

<style>
.mode-card {
  cursor:pointer;
  display:block;
  position:relative;
}

.mode-card input[type="radio"] {
  position:absolute;
  opacity:0;
  pointer-events:none;
}

.mode-card-content {
  padding:24px;
  border:2px solid var(--border);
  border-radius:8px;
  text-align:center;
  transition:all 0.2s;
}

.mode-card input[type="radio"]:checked + .mode-card-content {
  border-color:var(--primary);
  background:rgba(59, 130, 246, 0.05);
}

.mode-card:hover .mode-card-content {
  border-color:var(--primary);
}

.toggle-icon.rotated {
  transform:rotate(180deg);
}

.checkbox-label {
  display:flex;
  align-items:center;
  gap:8px;
  cursor:pointer;
  padding:8px;
  border-radius:4px;
  transition:background 0.2s;
}

.checkbox-label:hover {
  background:var(--bg-secondary);
}

.checkbox-label input[type="checkbox"] {
  width:18px;
  height:18px;
  cursor:pointer;
}

.form-group {
  margin-bottom:16px;
}

.form-group label {
  display:block;
  font-size:13px;
  font-weight:500;
  color:var(--text);
  margin-bottom:6px;
}

.form-control {
  width:100%;
  padding:10px 12px;
  font-size:14px;
  border:1px solid var(--border);
  border-radius:6px;
  background:var(--bg);
  color:var(--text);
  font-family:inherit;
}

.form-control:focus {
  outline:none;
  border-color:var(--primary);
  box-shadow:0 0 0 3px rgba(59, 130, 246, 0.1);
}

select.form-control {
  cursor:pointer;
}

textarea.form-control {
  resize:vertical;
}

/* Autocomplete Wrapper */
.autocomplete-wrapper {
  position:relative;
  z-index:100;  /* Ensure wrapper is above other elements */
}

/* Autocomplete Dropdown */
.autocomplete-dropdown {
  position:absolute;
  top:100%;
  left:0;
  right:0;
  margin-top:4px;
  background:var(--bg);
  border:1px solid var(--border);
  border-radius:8px;
  box-shadow:0 8px 24px rgba(0,0,0,0.2);
  max-height:400px;
  overflow-y:auto;
  z-index:9999;  /* Very high z-index to appear above everything */
}

.autocomplete-item {
  display:flex;
  align-items:center;
  gap:12px;
  padding:12px;
  border-bottom:1px solid var(--border);
  cursor:pointer;
  transition:background 0.15s;
}

.autocomplete-item:last-child {
  border-bottom:none;
}

.autocomplete-item:hover {
  background:var(--bg-secondary);
}

.autocomplete-item-image {
  width:50px;
  height:50px;
  border-radius:6px;
  object-fit:cover;
  background:var(--bg-secondary);
  flex-shrink:0;
}

.autocomplete-item-image-placeholder {
  width:50px;
  height:50px;
  border-radius:6px;
  background:var(--bg-secondary);
  display:flex;
  align-items:center;
  justify-content:center;
  flex-shrink:0;
}

.autocomplete-item-image-placeholder i {
  color:var(--text-tertiary);
  font-size:24px;
}

.autocomplete-item-details {
  flex:1;
  min-width:0;
}

.autocomplete-item-title {
  font-size:14px;
  font-weight:500;
  color:var(--text);
  margin-bottom:4px;
  overflow:hidden;
  text-overflow:ellipsis;
  white-space:nowrap;
}

.autocomplete-item-meta {
  font-size:12px;
  color:var(--text-secondary);
  display:flex;
  gap:12px;
  flex-wrap:wrap;
}

.autocomplete-item-meta span {
  display:flex;
  align-items:center;
  gap:4px;
}

.autocomplete-empty {
  padding:24px;
  text-align:center;
  color:var(--text-secondary);
  font-size:13px;
}

.autocomplete-empty i {
  font-size:32px;
  opacity:0.3;
  margin-bottom:8px;
  display:block;
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const modeAuto = document.getElementById('mode_auto');
  const modeManual = document.getElementById('mode_manual');
  const autoSettings = document.querySelector('.auto-settings');
  const frequencySelect = document.getElementById('frequency');
  const customIntervalGroup = document.getElementById('custom_interval_group');

  // Autocomplete elements
  const searchInput = document.getElementById('item_search');
  const searchResults = document.getElementById('search_results');
  const searchSpinner = document.getElementById('search_spinner');
  const selectedPreview = document.getElementById('selected_item_preview');
  const clearButton = document.getElementById('clear_selection');

  let searchTimeout;
  let selectedItem = null;

  // Handle mode change
  function updateMode() {
    if (modeAuto.checked) {
      autoSettings.style.display = 'block';
    } else {
      autoSettings.style.display = 'none';
    }
  }

  modeAuto.addEventListener('change', updateMode);
  modeManual.addEventListener('change', updateMode);
  updateMode();

  // Handle frequency change
  frequencySelect.addEventListener('change', function() {
    if (this.value === 'custom') {
      customIntervalGroup.style.display = 'block';
      document.getElementById('custom_interval_days').required = true;
    } else {
      customIntervalGroup.style.display = 'none';
      document.getElementById('custom_interval_days').required = false;
    }
  });

  // ==================== AUTOCOMPLETE SEARCH ====================

  // Search as user types (with debounce)
  searchInput.addEventListener('input', function() {
    const query = this.value.trim();

    // Clear previous timeout
    clearTimeout(searchTimeout);

    // Hide results if query is too short
    if (query.length < 2) {
      searchResults.style.display = 'none';
      return;
    }

    // Show spinner
    searchSpinner.style.display = 'block';

    // Debounce: Wait 300ms after user stops typing
    searchTimeout = setTimeout(() => {
      performSearch(query);
    }, 300);
  });

  // Perform AJAX search
  async function performSearch(query) {
    try {
      const response = await fetch(`{{ url_for('auto_relist.search_items_api') }}?q=${encodeURIComponent(query)}&limit=10`);
      const data = await response.json();

      searchSpinner.style.display = 'none';

      if (!data.success) {
        showError(data.error || 'Failed to search items');
        return;
      }

      displayResults(data.items);
    } catch (error) {
      searchSpinner.style.display = 'none';
      showError('Network error. Please try again.');
      console.error('Search error:', error);
    }
  }

  // Display search results
  function displayResults(items) {
    searchResults.innerHTML = '';

    if (items.length === 0) {
      searchResults.innerHTML = `
        <div class="autocomplete-empty">
          <i class="fas fa-search"></i>
          No items found matching your search.
        </div>
      `;
      searchResults.style.display = 'block';
      return;
    }

    items.forEach(item => {
      const resultItem = document.createElement('div');
      resultItem.className = 'autocomplete-item';
      resultItem.dataset.item = JSON.stringify(item);

      // Image or placeholder
      let imageHtml;
      if (item.image_url) {
        imageHtml = `<img src="${item.image_url}" class="autocomplete-item-image" alt="${item.title}">`;
      } else {
        imageHtml = `
          <div class="autocomplete-item-image-placeholder">
            <i class="fas fa-image"></i>
          </div>
        `;
      }

      resultItem.innerHTML = `
        ${imageHtml}
        <div class="autocomplete-item-details">
          <div class="autocomplete-item-title">${escapeHtml(item.title)}</div>
          <div class="autocomplete-item-meta">
            ${item.sku ? `<span><i class="fas fa-barcode"></i> ${escapeHtml(item.sku)}</span>` : ''}
            <span><i class="fas fa-dollar-sign"></i> ${item.price ? item.price.toFixed(2) : 'N/A'}</span>
            ${item.quantity ? `<span><i class="fas fa-boxes"></i> ${item.quantity}</span>` : ''}
          </div>
        </div>
      `;

      // Click handler
      resultItem.addEventListener('click', () => selectItem(item));

      searchResults.appendChild(resultItem);
    });

    searchResults.style.display = 'block';
  }

  // Select an item from results
  function selectItem(item) {
    selectedItem = item;

    // Populate hidden fields
    document.getElementById('hidden_offer_id').value = item.offer_id || '';
    document.getElementById('hidden_sku').value = item.sku || '';
    document.getElementById('hidden_title').value = item.title || '';
    document.getElementById('hidden_price').value = item.price || '';
    document.getElementById('hidden_listing_id').value = item.listing_id || '';

    // Update preview
    document.getElementById('preview_title').textContent = item.title || 'Unknown';
    document.getElementById('preview_sku').textContent = item.sku ? `SKU: ${item.sku}` : 'No SKU';
    document.getElementById('preview_price').textContent = item.price ? `$${item.price.toFixed(2)}` : 'N/A';
    document.getElementById('preview_listing').textContent = item.listing_id || 'N/A';

    // Show preview, hide search results
    selectedPreview.style.display = 'block';
    searchResults.style.display = 'none';
    searchInput.value = item.title;
    searchInput.disabled = true;
  }

  // Clear selection
  clearButton.addEventListener('click', function() {
    selectedItem = null;

    // Clear hidden fields
    document.getElementById('hidden_offer_id').value = '';
    document.getElementById('hidden_sku').value = '';
    document.getElementById('hidden_title').value = '';
    document.getElementById('hidden_price').value = '';
    document.getElementById('hidden_listing_id').value = '';

    // Hide preview
    selectedPreview.style.display = 'none';
    searchInput.value = '';
    searchInput.disabled = false;
    searchInput.focus();
  });

  // Close dropdown when clicking outside
  document.addEventListener('click', function(e) {
    if (!searchInput.contains(e.target) && !searchResults.contains(e.target)) {
      searchResults.style.display = 'none';
    }
  });

  // Show error message
  function showError(message) {
    searchResults.innerHTML = `
      <div class="autocomplete-empty" style="color:var(--danger);">
        <i class="fas fa-exclamation-triangle"></i>
        ${escapeHtml(message)}
      </div>
    `;
    searchResults.style.display = 'block';
  }

  // Escape HTML to prevent XSS
  function escapeHtml(text) {
    const div = document.createElement('div');
    div.textContent = text;
    return div.innerHTML;
  }

  // ==================== PRICE DECREASE HANDLING ====================

  const enablePriceDecrease = document.getElementById('enable_price_decrease');
  const priceDecreaseSettings = document.getElementById('price_decrease_settings');
  const priceDecreaseType = document.getElementById('price_decrease_type');
  const decreaseLabel = document.getElementById('decrease_label');
  const decreaseHint = document.getElementById('decrease_hint');

  // Toggle price decrease settings visibility
  enablePriceDecrease.addEventListener('change', function() {
    if (this.checked) {
      priceDecreaseSettings.style.display = 'block';
      document.getElementById('price_decrease_amount').required = true;
      document.getElementById('min_price').required = true;
    } else {
      priceDecreaseSettings.style.display = 'none';
      document.getElementById('price_decrease_amount').required = false;
      document.getElementById('min_price').required = false;
    }
  });

  // Update labels based on decrease type
  priceDecreaseType.addEventListener('change', function() {
    if (this.value === 'fixed') {
      decreaseLabel.textContent = 'Decrease Amount ($) *';
      decreaseHint.textContent = 'Example: $29.99 → $27.99 → $25.99';
      document.getElementById('price_decrease_amount').placeholder = '2.00';
    } else if (this.value === 'percentage') {
      decreaseLabel.textContent = 'Decrease Percentage (%) *';
      decreaseHint.textContent = 'Example: $30.00 → $27.00 (10%) → $24.30';
      document.getElementById('price_decrease_amount').placeholder = '10';
    }
  });
});
</script>
{% endblock %}
